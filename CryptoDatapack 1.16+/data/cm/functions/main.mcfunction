execute as @a[scores={open_chest=1..}] at @s run function cm:menu/update
scoreboard players set @a open_chest 0
scoreboard players add @a holding_item 0

setblock 0 1 0 air
setblock 0 1 0 oak_sign{Text1:'{"score":{"name":"$CryptoPrice","objective":"crypto.balance"},"color":"green","italic":false}'} replace
execute as @a[scores={holding_item=0},nbt={SelectedItem:{id:"minecraft:sunflower",tag:{open_cm:1b}}}] at @s run summon chest_minecart ~ ~ ~ {CustomName:'{"text":"Shop Menu","color":"blue","bold":true,"italic":false}',Motion:[0.0,0.0,0.0],Invulnerable:1b,CustomDisplayTile:1b,DisplayState:{Name:"minecraft:air"},Tags:["chest_menu"],Items:[{Slot:0b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:1b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:2b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:3b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:4b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:5b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:6b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:7b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:8b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:9b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:10b,id:"minecraft:netherite_block",Count:1b,tag:{display:{Name:'{"text":"Buy CryptoCoin","color":"yellow","bold":false,"italic":false}',Lore:['{"text":"Click to open menu"}']},HideFlags:127,isMenu:1b,page:0,selection:2}},{Slot:12b,id:"minecraft:netherite_ingot",Count:1b,tag:{display:{Name:'{"text":"Your CryptoCoin Balance","color":"yellow","italic":false},',Lore:['{"text":"Click to see it in chat"}']},HideFlags:127,isMenu:1b,page:0,selection:3}},{Slot:14b,id:"minecraft:diamond_block",Count:1b,tag:{display:{Name:'{"text":"Sell CryptoCoin","color":"yellow","bold":false,"italic":false}',Lore:['{"text":"Click to open menu"}']},HideFlags:127,isMenu:1b,page:0,selection:4}},{Slot:16b,id:"minecraft:diamond",Count:1b,tag:{display:{Name:'{"text":"Your Balance","color":"yellow","italic":false},',Lore:['{"text":"Click to see it in chat"}']},HideFlags:127,isMenu:1b,page:0,selection:5}},{Slot:17b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:18b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:19b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:20b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:21b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:22b,id:"minecraft:emerald",Count:1b,tag:{display:{Name:'{"text":"Price of Crypto: ","color":"yellow","italic":false},',Lore:['{"text":" "}']},HideFlags:127,isMenu:1b,page:0,selection:1}},{Slot:23b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:24b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:25b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}},{Slot:26b,id:'minecraft:gray_stained_glass_pane',Count:1b,tag:{display:{Name:'{"text":" "}'},HideFlags:127,page:0,selection:1,isMenu:1b}}]}
execute as @e[nbt={Items:[{Slot:22b,id:"minecraft:emerald"}]}] run data modify entity @s Items[19].tag.display.Lore[0] set from block 0 1 0 Text1
execute as @a[nbt={SelectedItem:{id:"minecraft:sunflower",tag:{open_cm:1b}}}] at @s run scoreboard players set @s holding_item 1
execute as @a[scores={holding_item=1},nbt=!{SelectedItem:{id:"minecraft:sunflower",tag:{open_cm:1b}}}] at @s run scoreboard players set @s holding_item 0
execute as @a[scores={holding_item=0}] at @s run data remove entity @e[tag=chest_menu,type=minecraft:chest_minecart,distance=0..2,limit=1,sort=nearest] Items
execute as @a[scores={holding_item=0}] at @s run kill @e[tag=chest_menu,type=minecraft:chest_minecart,distance=0..2,limit=1,sort=nearest]
execute positioned as @a[scores={holding_item=1}] as @e[tag=chest_menu,distance=0..3,limit=1,sort=nearest] run tp @s ~ ~-0.69 ~

execute positioned as @a as @e[tag=chest_menu,type=minecraft:chest_minecart,distance=4..,limit=1,sort=nearest] at @s run data remove entity @s Items
execute positioned as @a as @e[tag=chest_menu,type=minecraft:chest_minecart,distance=4..,limit=1,sort=nearest] at @s run kill @s



execute as @a at @s run function cm:menu/check